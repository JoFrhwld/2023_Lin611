{
  "hash": "980b5492026dc4ee76ce1df86500a275",
  "result": {
    "markdown": "---\ntitle: \"Generalized Linear Models\"\nauthor: \"Josef Fruehwald\"\nknitr: \n  opts_chunk: \n    message: false\n---\n\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(broom.mixed)\nlibrary(marginaleffects)\n```\n:::\n\n\n## Logistic Regression (a.k.a. binary data)\n\n\n::: {.cell}\n\n```{.r .cell-code}\num_dat <- read_tsv(\"https://bit.ly/3JdeSbx\")\ndemog <- read_csv(\"https://bit.ly/3wOfcGx\")\n\num_dat <- um_dat |> \n  left_join(demog)\n```\n:::\n\n\n### Preparing for modelling\n\n\n::: {.cell}\n\n```{.r .cell-code}\num_dat |> \n  # only looking at UM and UH\n  filter(\n    word %in% c(\"UM\", \"UH\"),\n    is.finite(dob)\n  )  |> \n  mutate(\n    # 0 if UH, 1 if UM\n    um_binary = (word == \"UM\") * 1,\n    # centering and scaling dob\n    dob_c = dob - 1970,\n    dob_s = dob_c / 25,\n    # setting gender levels\n    gender = fct_relevel(gender, \"f\")\n  ) -> um_to_model\n```\n:::\n\n\n### Modelling\n\n\n::: {.cell}\n\n```{.r .cell-code}\num_model <- glmer(um_binary ~ dob_s * gender + (1 | idstring),\n                  data = um_to_model,\n                  family = binomial)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(um_model) |> \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"effect\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"group\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"fixed\",\"2\":\"NA\",\"3\":\"(Intercept)\",\"4\":\"0.2855643\",\"5\":\"0.12891371\",\"6\":\"2.215159\",\"7\":\"2.674917e-02\"},{\"1\":\"fixed\",\"2\":\"NA\",\"3\":\"dob_s\",\"4\":\"1.2690808\",\"5\":\"0.09931317\",\"6\":\"12.778575\",\"7\":\"2.159899e-37\"},{\"1\":\"fixed\",\"2\":\"NA\",\"3\":\"genderm\",\"4\":\"-1.1195200\",\"5\":\"0.20465244\",\"6\":\"-5.470348\",\"7\":\"4.491539e-08\"},{\"1\":\"fixed\",\"2\":\"NA\",\"3\":\"dob_s:genderm\",\"4\":\"0.4524445\",\"5\":\"0.17051302\",\"6\":\"2.653431\",\"7\":\"7.967808e-03\"},{\"1\":\"ran_pars\",\"2\":\"idstring\",\"3\":\"sd__(Intercept)\",\"4\":\"1.2649001\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"NA\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Predictions\n\nJust to get a sense of the range of `dob_s`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(um_to_model$dob_s)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n -3.240  -1.760  -1.040  -1.061  -0.440   1.120 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npredictions(\n  um_model,\n  newdata = datagrid(\n    dob_s = seq(-3, 1, length = 100),\n    gender = c(\"f\", \"m\")\n  ),\n  type = \"response\",\n  re.form = NA\n) |> \n  as_tibble() ->\n  um_prob_pred\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\num_prob_pred |> \n  mutate(dob = (dob_s * 25) + 1970) |>\n  ggplot(aes(dob, estimate, color = gender, fill = gender))+\n    geom_ribbon(\n      aes(ymin = conf.low, ymax = conf.high),\n      alpha = 0.3\n    )+\n    geom_line()+\n    scale_color_brewer(palette = \"Dark2\")+\n    scale_fill_brewer(palette = \"Dark2\")+\n    theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Poisson (or Count)\n\n\n::: {.cell}\n\n```{.r .cell-code}\num_dat |> \n  summarise(\n    .by = c(idstring, age, gender, nwords),\n    total_fp = n(),\n  )->\n  fp_count\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfp_count |> \n  mutate(\n    age_c = age - 40,\n    age_s = age_c/10,\n    gender = fct_relevel(gender, \"m\")\n  ) ->\n  fp_to_model\n```\n:::\n\n\n### Modelling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfp_mod <- glmer(total_fp ~ age_s * gender + offset(log(nwords)) + (1|idstring),\n                data = fp_to_model,\n                family = poisson)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(fp_mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 Ã— 7\n  effect   group    term            estimate std.error statistic    p.value\n  <chr>    <chr>    <chr>              <dbl>     <dbl>     <dbl>      <dbl>\n1 fixed    <NA>     (Intercept)      -4.22      0.0524    -80.4   0        \n2 fixed    <NA>     age_s             0.106     0.0259      4.11  0.0000400\n3 fixed    <NA>     genderf          -0.0795    0.0699     -1.14  0.255    \n4 fixed    <NA>     age_s:genderf    -0.0476    0.0334     -1.43  0.154    \n5 ran_pars idstring sd__(Intercept)   0.662    NA          NA    NA        \n```\n:::\n:::\n\n\n### Predictions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fp_to_model$nwords)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n    274    1928    2725    3583    4376   20489 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npredictions(\n  fp_mod,\n  newdata = datagrid(\n    age_s = seq(-2, 5, length = 100),\n    gender = c(\"f\", \"m\"),\n    nwords = 1000\n  ),\n  re.form = NA,\n  type = \"response\"\n) |>\n  as_tibble()->\n  fp_pred\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfp_pred |> \n  mutate(age = (age_s * 10) + 40) |>\n  ggplot(aes(age, estimate, color = gender, fill = gender))+\n    geom_ribbon(aes(ymin = conf.low, ymax = conf.high),\n                alpha = 0.3)+\n    geom_line()+\n    scale_color_brewer(palette = \"Dark2\")+\n    scale_fill_brewer(palette = \"Dark2\")+\n    labs(y = \"filled pauses per 1,000 words\")+\n    theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}